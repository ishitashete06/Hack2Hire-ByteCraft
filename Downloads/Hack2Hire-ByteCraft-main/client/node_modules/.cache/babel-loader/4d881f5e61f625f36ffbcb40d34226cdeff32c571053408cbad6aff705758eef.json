{"ast":null,"code":"/**\n * @internal\n */\nexport class Observers {\n  observers = new Set();\n  transactions = {};\n  add(observer) {\n    this.observers.add(observer);\n    let isCalled = false;\n    return () => {\n      if (isCalled) {\n        return;\n      }\n      isCalled = true;\n      this.remove(observer);\n    };\n  }\n  remove(observer) {\n    this.observers.delete(observer);\n  }\n  notify(change, transaction) {\n    if (transaction) {\n      const accumulatedChange = this.transactions[transaction] || change;\n      accumulatedChange.value = change.value;\n      this.transactions[transaction] = accumulatedChange;\n    } else {\n      this.callObservers(change);\n    }\n  }\n  finishTransaction(transaction) {\n    const accumulatedChange = this.transactions[transaction];\n    delete this.transactions[transaction];\n    return this.callObservers(accumulatedChange, transaction);\n  }\n  callObservers(change, transaction) {\n    const finishObservers = [];\n    // Make a copy and de-duplicate so we always call all handlers,\n    // even if the handler array changes because of handler call\n    new Set(this.observers).forEach(observer => {\n      if (typeof observer === \"function\") {\n        observer(change, transaction);\n      } else {\n        observer.update(change, transaction);\n        finishObservers.push(observer.finish);\n      }\n    });\n    return finishObservers;\n  }\n}","map":{"version":3,"names":["Observers","observers","Set","transactions","add","observer","isCalled","remove","delete","notify","change","transaction","accumulatedChange","value","callObservers","finishTransaction","finishObservers","forEach","update","push","finish"],"sources":["../../../src/animation/Animatable/Observers.ts"],"sourcesContent":[null],"mappings":"AA2BA;;;AAGA,OAAM,MAAOA,SAAS;EACVC,SAAS,GAAyB,IAAIC,GAAG,EAAE;EAC3CC,YAAY,GAAqC,EAAE;EAC3DC,GAAGA,CAACC,QAAyB;IACzB,IAAI,CAACJ,SAAS,CAACG,GAAG,CAACC,QAAQ,CAAC;IAC5B,IAAIC,QAAQ,GAAG,KAAK;IACpB,OAAO,MAAK;MACR,IAAIA,QAAQ,EAAE;QACV;;MAEJA,QAAQ,GAAG,IAAI;MACf,IAAI,CAACC,MAAM,CAACF,QAAQ,CAAC;IACzB,CAAC;EACL;EAEQE,MAAMA,CAACF,QAAyB;IACpC,IAAI,CAACJ,SAAS,CAACO,MAAM,CAACH,QAAQ,CAAC;EACnC;EAEAI,MAAMA,CAACC,MAAqB,EAAEC,WAA2B;IACrD,IAAIA,WAAW,EAAE;MACb,MAAMC,iBAAiB,GAAG,IAAI,CAACT,YAAY,CAACQ,WAAW,CAAC,IAAID,MAAM;MAClEE,iBAAiB,CAACC,KAAK,GAAGH,MAAM,CAACG,KAAK;MACtC,IAAI,CAACV,YAAY,CAACQ,WAAW,CAAC,GAAGC,iBAAiB;KACrD,MAAM;MACH,IAAI,CAACE,aAAa,CAACJ,MAAM,CAAC;;EAElC;EAEAK,iBAAiBA,CAACJ,WAA0B;IACxC,MAAMC,iBAAiB,GAAG,IAAI,CAACT,YAAY,CAACQ,WAAW,CAAC;IACxD,OAAO,IAAI,CAACR,YAAY,CAACQ,WAAW,CAAC;IACrC,OAAO,IAAI,CAACG,aAAa,CAACF,iBAAiB,EAAED,WAAW,CAAC;EAC7D;EAEQG,aAAaA,CAACJ,MAAiC,EAAEC,WAA2B;IAChF,MAAMK,eAAe,GAAqB,EAAE;IAC5C;IACA;IACA,IAAId,GAAG,CAAC,IAAI,CAACD,SAAS,CAAC,CAACgB,OAAO,CAACZ,QAAQ,IAAG;MACvC,IAAI,OAAOA,QAAQ,KAAK,UAAU,EAAE;QAChCA,QAAQ,CAACK,MAAM,EAAEC,WAAW,CAAC;OAChC,MAAM;QACHN,QAAQ,CAACa,MAAM,CAACR,MAAM,EAAEC,WAAW,CAAC;QACpCK,eAAe,CAACG,IAAI,CAACd,QAAQ,CAACe,MAAM,CAAC;;IAE7C,CAAC,CAAC;IACF,OAAOJ,eAAe;EAC1B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}