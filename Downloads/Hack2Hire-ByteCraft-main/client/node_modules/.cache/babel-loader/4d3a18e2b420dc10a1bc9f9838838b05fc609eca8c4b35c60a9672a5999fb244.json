{"ast":null,"code":"import { isFramerX, isSafari, isTest } from \"../../utils/environment.js\";\nimport { RenderTarget } from \"../types/RenderEnvironment.js\";\n/**\n * This file contains a bunch of helpers to force browser to render elements\n * with layer backing (GPU accelleration)\n */\n/**\n * The string in this smallValue is very specifically \"0.000001px\".\n *\n * - Safari before Catalina will change 1e-7 into 0.0000001px\n * - Safari in Catalina will change 0.0000001px into 1e-7\n *\n * So this value should be \"0.000001px\" (1e-6) and not smaller, because\n * otherwise it will break the string replacement for removing the translateZ\n * hack.\n */\nconst smallValue = \"0.000001px\";\nexport const translateZ = ` translateZ(${smallValue})`;\n// We only apply this hack on the canvas and in Safari or FramerX\nconst useTranslateZHack = isFramerX() || isSafari() || isTest();\n/**\n * Forces layer backing during rendering with a motion style\n */\nexport function forceLayerBackingWithMotionStyle(motionStyle) {\n  // This forces 3d acceleration on Chrome\n  motionStyle.willChange = \"transform\";\n  // We only want to use the translateZ hack on the canvas\n  const onCanvas = RenderTarget.current() === RenderTarget.canvas;\n  if (useTranslateZHack && onCanvas) {\n    motionStyle.translateZ = smallValue;\n  }\n}\n/**\n * Forces layer backing during rendering with React's CSS properties\n *\n * @internal\n */\nexport function forceLayerBackingWithCSSProperties(cssProperties) {\n  // This forces 3d acceleration on Chrome\n  cssProperties.willChange = \"transform\";\n  setTranslateZHack(cssProperties, true);\n}\n/**\n * Forces layer backing by changing the style of an HTML Element that is already\n * rendered to the DOM\n * @param element The HTML element to force the layer backing on\n * @param enabled Whether to enable forced layer backing. If `true` the styles\n * will be modified to force layer backing. If `false` those styles will be\n * removed from the element\n */\nexport function forceLayerBackingOnElement(element, enabled) {\n  if (enabled) {\n    const willChange = element.style.willChange || \"\";\n    if (willChange !== \"transform\") {\n      // This forces 3d acceleration on Chrome\n      element.style.willChange = \"transform\";\n    }\n  } else {\n    element.style.removeProperty(\"will-change\");\n  }\n  setTranslateZHack(element.style, enabled);\n}\n/**\n * Within Safari we can force gpu layers (avoid dumping them) by adding a small\n * translateZ value:\n * https://github.com/WebKit/webkit/blob/6ddbf54e861f9df5e0171422c32cc6173120f717/LayoutTests/compositing/layer-creation/compositing-policy.html#L23\n * So to prevent this memory heuristic to trigger, we also rig those layers with\n * a tiny translateZ property.\n */\nfunction setTranslateZHack(style, enabled) {\n  const onCanvas = RenderTarget.current() === RenderTarget.canvas;\n  if (!useTranslateZHack || !onCanvas) {\n    // We only want to use the translateZ hack in Safari and FramerX on the canvas\n    return;\n  }\n  const transform = style.transform || \"\";\n  if (enabled) {\n    const hasTranslateZ = transform.includes(translateZ);\n    if (!hasTranslateZ) {\n      style.transform = transform + translateZ;\n    }\n  } else {\n    style.transform = transform.replace(translateZ, \"\");\n  }\n}","map":{"version":3,"names":["isFramerX","isSafari","isTest","RenderTarget","smallValue","translateZ","useTranslateZHack","forceLayerBackingWithMotionStyle","motionStyle","willChange","onCanvas","current","canvas","forceLayerBackingWithCSSProperties","cssProperties","setTranslateZHack","forceLayerBackingOnElement","element","enabled","style","removeProperty","transform","hasTranslateZ","includes","replace"],"sources":["../../../src/render/utils/setLayerBacked.ts"],"sourcesContent":[null],"mappings":"AAGA,SAASA,SAAS,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,4BAA4B;AACxE,SAASC,YAAY,QAAQ,+BAA+B;AAE5D;;;;AAKA;;;;;;;;;;AAUA,MAAMC,UAAU,GAAG,YAAY;AAC/B,OAAO,MAAMC,UAAU,GAAG,eAAeD,UAAU,GAAG;AACtD;AACA,MAAME,iBAAiB,GAAGN,SAAS,EAAE,IAAIC,QAAQ,EAAE,IAAIC,MAAM,EAAE;AAE/D;;;AAGA,OAAM,SAAUK,gCAAgCA,CAACC,WAAwB;EACrE;EACAA,WAAW,CAACC,UAAU,GAAG,WAAW;EAEpC;EACA,MAAMC,QAAQ,GAAGP,YAAY,CAACQ,OAAO,EAAE,KAAKR,YAAY,CAACS,MAAM;EAE/D,IAAIN,iBAAiB,IAAII,QAAQ,EAAE;IAC/BF,WAAW,CAACH,UAAU,GAAGD,UAAU;;AAE3C;AAEA;;;;;AAKA,OAAM,SAAUS,kCAAkCA,CAACC,aAA4B;EAC3E;EACAA,aAAa,CAACL,UAAU,GAAG,WAAW;EACtCM,iBAAiB,CAACD,aAAa,EAAE,IAAI,CAAC;AAC1C;AAEA;;;;;;;;AAQA,OAAM,SAAUE,0BAA0BA,CAACC,OAAoB,EAAEC,OAAgB;EAC7E,IAAIA,OAAO,EAAE;IACT,MAAMT,UAAU,GAAGQ,OAAO,CAACE,KAAK,CAACV,UAAU,IAAI,EAAE;IACjD,IAAIA,UAAU,KAAK,WAAW,EAAE;MAC5B;MACAQ,OAAO,CAACE,KAAK,CAACV,UAAU,GAAG,WAAW;;GAE7C,MAAM;IACHQ,OAAO,CAACE,KAAK,CAACC,cAAc,CAAC,aAAa,CAAC;;EAE/CL,iBAAiB,CAACE,OAAO,CAACE,KAAK,EAAED,OAAO,CAAC;AAC7C;AAEA;;;;;;;AAQA,SAASH,iBAAiBA,CAACI,KAA0C,EAAED,OAAgB;EACnF,MAAMR,QAAQ,GAAGP,YAAY,CAACQ,OAAO,EAAE,KAAKR,YAAY,CAACS,MAAM;EAC/D,IAAI,CAACN,iBAAiB,IAAI,CAACI,QAAQ,EAAE;IACjC;IACA;;EAEJ,MAAMW,SAAS,GAAGF,KAAK,CAACE,SAAS,IAAI,EAAE;EACvC,IAAIH,OAAO,EAAE;IACT,MAAMI,aAAa,GAAGD,SAAS,CAACE,QAAQ,CAAClB,UAAU,CAAC;IACpD,IAAI,CAACiB,aAAa,EAAE;MAChBH,KAAK,CAACE,SAAS,GAAGA,SAAS,GAAGhB,UAAU;;GAE/C,MAAM;IACHc,KAAK,CAACE,SAAS,GAAGA,SAAS,CAACG,OAAO,CAACnB,UAAU,EAAE,EAAE,CAAC;;AAE3D","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}