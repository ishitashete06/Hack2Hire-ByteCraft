{"ast":null,"code":"import { assert } from \"../../utils/assert.js\";\nimport { PathSegment } from \"../types/PathSegment.js\";\nimport { RenderTarget } from \"../types/RenderEnvironment.js\";\nimport { isFiniteNumber } from \"../utils/isFiniteNumber.js\";\nimport { roundedNumberString } from \"../utils/roundedNumber.js\";\nconst key = \"pathSegments\";\n/**\n * @internal\n */\nexport function withPath(target) {\n  return key in target;\n}\n/**\n * @internal\n */\nexport const pathDefaults = {\n  pathSegments: [],\n  pathClosed: false\n};\n/**\n * @internal\n */\nexport function toSVGPath(withPaths, translate = {\n  x: 0,\n  y: 0\n}, canvasMode = RenderTarget.canvas) {\n  let pathElements = [];\n  let paths = [];\n  if (Array.isArray(withPaths)) {\n    paths = withPaths;\n  } else {\n    paths = [withPaths];\n  }\n  paths.forEach(path => {\n    const {\n      pathClosed,\n      pathSegments\n    } = path;\n    const segmentCount = pathSegments.length;\n    if (segmentCount === 0) return \"\";\n    for (let i = 0; i < segmentCount; i++) {\n      const segment = pathSegments[i];\n      assert(segment, \"Path segment must be defined\");\n      let nextSegment;\n      let prevSegment;\n      const isFirstSegment = i === 0;\n      const isLastSegment = i === segmentCount - 1;\n      if (!isLastSegment) {\n        nextSegment = pathSegments[i + 1];\n      } else if (pathClosed) {\n        nextSegment = pathSegments[0];\n      }\n      if (!isFirstSegment) {\n        prevSegment = pathSegments[i - 1];\n      } else if (pathClosed) {\n        prevSegment = pathSegments[segmentCount - 1];\n      }\n      if (i === 0) {\n        pathElements.push(\"M\");\n      } else if (prevSegment && isStraightCurve(prevSegment, segment)) {\n        pathElements.push(\"L\");\n      }\n      pathElements.push(segment.x + translate.x, segment.y + translate.y);\n      if (nextSegment && !isStraightCurve(segment, nextSegment)) {\n        const handleOut = PathSegment.calculatedHandleOut(segment);\n        const handleIn = PathSegment.calculatedHandleIn(nextSegment);\n        pathElements.push(\"C\", handleOut.x + translate.x, handleOut.y + translate.y, handleIn.x + translate.x, handleIn.y + translate.y);\n      }\n      if (isLastSegment && nextSegment) {\n        if (isStraightCurve(segment, nextSegment)) {\n          pathElements.push(\"Z\");\n        } else {\n          pathElements.push(nextSegment.x + translate.x, nextSegment.y + translate.y, \"Z\");\n        }\n      }\n    }\n  });\n  if (canvasMode === RenderTarget.export || canvasMode === RenderTarget.preview) {\n    pathElements = pathElements.map(value => isFiniteNumber(value) ? roundedNumberString(value, 3) : value);\n  }\n  return pathElements.join(\" \");\n}\n/**\n * @internal\n */\nexport function isStraightCurve(fromSegment, toSegment) {\n  const fromStraight = fromSegment.handleMirroring === \"straight\" || fromSegment.handleOutX === 0 && fromSegment.handleOutY === 0;\n  const toStraight = toSegment.handleMirroring === \"straight\" || toSegment.handleInX === 0 && toSegment.handleInY === 0;\n  return fromStraight && toStraight;\n}","map":{"version":3,"names":["assert","PathSegment","RenderTarget","isFiniteNumber","roundedNumberString","key","withPath","target","pathDefaults","pathSegments","pathClosed","toSVGPath","withPaths","translate","x","y","canvasMode","canvas","pathElements","paths","Array","isArray","forEach","path","segmentCount","length","i","segment","nextSegment","prevSegment","isFirstSegment","isLastSegment","push","isStraightCurve","handleOut","calculatedHandleOut","handleIn","calculatedHandleIn","export","preview","map","value","join","fromSegment","toSegment","fromStraight","handleMirroring","handleOutX","handleOutY","toStraight","handleInX","handleInY"],"sources":["../../../src/render/traits/Path.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}