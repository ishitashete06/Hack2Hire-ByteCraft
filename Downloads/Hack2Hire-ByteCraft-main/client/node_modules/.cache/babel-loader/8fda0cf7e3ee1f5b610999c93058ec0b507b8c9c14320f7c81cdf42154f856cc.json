{"ast":null,"code":"import React from \"react\";\nimport { isSafari, safariVersion } from \"../utils/environment.js\";\nfunction triggerStackReflow(element, display) {\n  if (!element) return;\n  element.style.display = \"none\";\n  // trigger the browser to synchronously calculate the layout\n  void element.offsetHeight;\n  // Re-enable flexbox\n  element.style.display = display;\n}\nconst requiresPolyfill = Boolean(isSafari() && safariVersion() < 15.4);\n/**\n * Until Safari 15.4, Webkit did not redraw the gaps correctly when the value\n * updated. A forced reflow is needed as a workaround.\n *\n * For layout transitions, we try to trigger the reflow in the\n * onBeforeMeasureLayout lifecycle, so that motion could capture the forced\n * layout change when it measures the new layout.\n *\n * We still need a layout effect to trigger the reflow, in case\n * onBeforeMeasureLayout isn't called (e.g. updating gap on the canvas).\n * https://bugs.webkit.org/show_bug.cgi?id=233252\n *\n * @internal\n */\nexport function useSafariGapFix(gap, ref, display) {\n  // Safari Version cannot change between renders, so it is always safe to\n  // early return without violating the rule of hooks.\n  if (!requiresPolyfill) return undefined;\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const isInitialRender = React.useRef(true);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const hasTriggeredReflow = React.useRef(false);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  const prevGapValue = React.useRef(gap);\n  hasTriggeredReflow.current = false;\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  React.useLayoutEffect(() => {\n    prevGapValue.current = gap;\n    if (isInitialRender.current) {\n      isInitialRender.current = false;\n      return;\n    }\n    if (!hasTriggeredReflow.current) {\n      triggerStackReflow(ref.current, display);\n      hasTriggeredReflow.current = true;\n    }\n  }, [gap, ref, prevGapValue, display]);\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  return React.useCallback(() => {\n    // The workaround is only required if the layout change\n    // is triggered by gap value changes\n    if (prevGapValue.current === gap) return;\n    if (!hasTriggeredReflow.current) triggerStackReflow(ref.current, display);\n    hasTriggeredReflow.current = true;\n  }, [gap, ref]);\n}","map":{"version":3,"names":["React","isSafari","safariVersion","triggerStackReflow","element","display","style","offsetHeight","requiresPolyfill","Boolean","useSafariGapFix","gap","ref","undefined","isInitialRender","useRef","hasTriggeredReflow","prevGapValue","current","useLayoutEffect","useCallback"],"sources":["../../src/modules/useSafariGapFix.tsx"],"sourcesContent":[null],"mappings":"AAEA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,EAAEC,aAAa,QAAQ,yBAAyB;AAEjE,SAASC,kBAAkBA,CAACC,OAA2B,EAAEC,OAAyB;EAC9E,IAAI,CAACD,OAAO,EAAE;EAEdA,OAAO,CAACE,KAAK,CAACD,OAAO,GAAG,MAAM;EAC9B;EACA,KAAKD,OAAO,CAACG,YAAY;EACzB;EACAH,OAAO,CAACE,KAAK,CAACD,OAAO,GAAGA,OAAO;AACnC;AAEA,MAAMG,gBAAgB,GAAGC,OAAO,CAACR,QAAQ,EAAE,IAAIC,aAAa,EAAE,GAAG,IAAI,CAAC;AACtE;;;;;;;;;;;;;;AAcA,OAAM,SAAUQ,eAAeA,CAC3BC,GAAW,EACXC,GAA+C,EAC/CP,OAAyB;EAEzB;EACA;EACA,IAAI,CAACG,gBAAgB,EAAE,OAAOK,SAAS;EAEvC;EACA,MAAMC,eAAe,GAAGd,KAAK,CAACe,MAAM,CAAC,IAAI,CAAC;EAC1C;EACA,MAAMC,kBAAkB,GAAGhB,KAAK,CAACe,MAAM,CAAU,KAAK,CAAC;EACvD;EACA,MAAME,YAAY,GAAGjB,KAAK,CAACe,MAAM,CAACJ,GAAG,CAAC;EAEtCK,kBAAkB,CAACE,OAAO,GAAG,KAAK;EAElC;EACAlB,KAAK,CAACmB,eAAe,CAAC,MAAK;IACvBF,YAAY,CAACC,OAAO,GAAGP,GAAG;IAE1B,IAAIG,eAAe,CAACI,OAAO,EAAE;MACzBJ,eAAe,CAACI,OAAO,GAAG,KAAK;MAC/B;;IAGJ,IAAI,CAACF,kBAAkB,CAACE,OAAO,EAAE;MAC7Bf,kBAAkB,CAACS,GAAG,CAACM,OAAO,EAAEb,OAAO,CAAC;MACxCW,kBAAkB,CAACE,OAAO,GAAG,IAAI;;EAEzC,CAAC,EAAE,CAACP,GAAG,EAAEC,GAAG,EAAEK,YAAY,EAAEZ,OAAO,CAAC,CAAC;EAErC;EACA,OAAOL,KAAK,CAACoB,WAAW,CAAC,MAAK;IAC1B;IACA;IACA,IAAIH,YAAY,CAACC,OAAO,KAAKP,GAAG,EAAE;IAElC,IAAI,CAACK,kBAAkB,CAACE,OAAO,EAAEf,kBAAkB,CAACS,GAAG,CAACM,OAAO,EAAEb,OAAO,CAAC;IAEzEW,kBAAkB,CAACE,OAAO,GAAG,IAAI;EACrC,CAAC,EAAE,CAACP,GAAG,EAAEC,GAAG,CAAC,CAAC;AAClB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}