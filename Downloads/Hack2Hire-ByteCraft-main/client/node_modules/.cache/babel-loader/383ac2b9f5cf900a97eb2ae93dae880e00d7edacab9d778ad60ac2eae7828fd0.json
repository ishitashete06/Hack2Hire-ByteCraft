{"ast":null,"code":"import React from \"react\";\nimport { useOnCurrentTargetChange } from \"../components/NavigationTargetContext.js\";\nimport { useConstant } from \"../components/utils/useConstant.js\";\nfunction rejectPending(pendingTimers, pendingPromises) {\n  pendingTimers.forEach(t => clearTimeout(t));\n  pendingTimers.clear();\n  pendingPromises.forEach(reject => reject && reject(\"Callback cancelled by variant change\"));\n  pendingPromises.clear();\n}\nfunction createSet() {\n  return new Set();\n}\n/**\n * Create callbacks that can be cancelled if the component is unmounted, the\n * active variant changes, or the component moves out of the target screen in a\n * Framer prototype.\n *\n * @public\n */\nexport function useActiveVariantCallback(baseVariant) {\n  const pendingPromises = useConstant(createSet);\n  const pendingTimers = useConstant(createSet);\n  // If the component moves out of the current screen in a Framer prototype,\n  // or the current screen is being unmounted via an AnimatePresence animation\n  // cancel all pending events.\n  useOnCurrentTargetChange(() => {\n    return () => rejectPending(pendingTimers, pendingPromises);\n  });\n  // If the component is unmounted, cancel all pending events.\n  React.useEffect(() => {\n    return () => rejectPending(pendingTimers, pendingPromises);\n  }, [pendingPromises, pendingTimers]);\n  // If the base variant of the component changes, cancel all pending events.\n  React.useEffect(() => {\n    rejectPending(pendingTimers, pendingPromises);\n  }, [baseVariant, pendingPromises, pendingTimers]);\n  return React.useRef({\n    /**\n     * Create a callback that can be cancelled if the base variant changes.\n     */\n    activeVariantCallback: callback => (...args) => {\n      return new Promise((resolve, reject) => {\n        pendingPromises.add(reject);\n        return callback(...args).then(resolve);\n      }).catch(() => {\n        // Swallow errors caused by rejecting this promise.\n      });\n    },\n    /**\n     * Execute a callback after a defined period of time. The callback will not\n     * be called if pending events are cancelled because the timeout will be\n     * cancelled.\n     */\n    delay: async (callback, msDelay) => {\n      await new Promise(resolve => pendingTimers.add(globalThis.setTimeout(() => resolve(true), msDelay)));\n      callback();\n    }\n  }).current;\n}\n/**\n * Create callbacks that can be cancelled if the component is unmounted, or the\n * component moves out of the target screen in a Framer prototype.\n *\n * @internal\n */\nexport function useActiveTargetCallback() {\n  const value = useActiveVariantCallback(undefined);\n  return React.useRef({\n    activeTargetCallback: value.activeVariantCallback,\n    delay: value.delay\n  }).current;\n}","map":{"version":3,"names":["React","useOnCurrentTargetChange","useConstant","rejectPending","pendingTimers","pendingPromises","forEach","t","clearTimeout","clear","reject","createSet","Set","useActiveVariantCallback","baseVariant","useEffect","useRef","activeVariantCallback","callback","args","Promise","resolve","add","then","catch","delay","msDelay","globalThis","setTimeout","current","useActiveTargetCallback","value","undefined","activeTargetCallback"],"sources":["../../src/modules/useActiveVariantCallback.ts"],"sourcesContent":[null],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,wBAAwB,QAAQ,0CAA0C;AACnF,SAASC,WAAW,QAAQ,oCAAoC;AAMhE,SAASC,aAAaA,CAACC,aAAyB,EAAEC,eAAoC;EAClFD,aAAa,CAACE,OAAO,CAACC,CAAC,IAAIC,YAAY,CAACD,CAAC,CAAC,CAAC;EAC3CH,aAAa,CAACK,KAAK,EAAE;EAErBJ,eAAe,CAACC,OAAO,CAACI,MAAM,IAAIA,MAAM,IAAIA,MAAM,CAAC,sCAAsC,CAAC,CAAC;EAC3FL,eAAe,CAACI,KAAK,EAAE;AAC3B;AAEA,SAASE,SAASA,CAAA;EACd,OAAO,IAAIC,GAAG,EAAK;AACvB;AAEA;;;;;;;AAOA,OAAM,SAAUC,wBAAwBA,CAACC,WAA+B;EACpE,MAAMT,eAAe,GAAGH,WAAW,CAAsBS,SAAS,CAAC;EACnE,MAAMP,aAAa,GAAGF,WAAW,CAAaS,SAAS,CAAC;EAExD;EACA;EACA;EACAV,wBAAwB,CAAC,MAAK;IAC1B,OAAO,MAAME,aAAa,CAACC,aAAa,EAAEC,eAAe,CAAC;EAC9D,CAAC,CAAC;EAEF;EACAL,KAAK,CAACe,SAAS,CAAC,MAAK;IACjB,OAAO,MAAMZ,aAAa,CAACC,aAAa,EAAEC,eAAe,CAAC;EAC9D,CAAC,EAAE,CAACA,eAAe,EAAED,aAAa,CAAC,CAAC;EAEpC;EACAJ,KAAK,CAACe,SAAS,CAAC,MAAK;IACjBZ,aAAa,CAACC,aAAa,EAAEC,eAAe,CAAC;EACjD,CAAC,EAAE,CAACS,WAAW,EAAET,eAAe,EAAED,aAAa,CAAC,CAAC;EAEjD,OAAOJ,KAAK,CAACgB,MAAM,CAAC;IAChB;;;IAGAC,qBAAqB,EAChBC,QAAqD,IACtD,CAAC,GAAGC,IAAW,KAAI;MACf,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEX,MAAM,KAAI;QACnCL,eAAe,CAACiB,GAAG,CAACZ,MAAM,CAAC;QAC3B,OAAOQ,QAAQ,CAAC,GAAGC,IAAI,CAAC,CAACI,IAAI,CAACF,OAAO,CAAC;MAC1C,CAAC,CAAC,CAACG,KAAK,CAAC,MAAK;QACV;MAAA,CACH,CAAC;IACN,CAAC;IAEL;;;;;IAKAC,KAAK,EAAE,MAAAA,CAAOP,QAAoB,EAAEQ,OAAe,KAAI;MACnD,MAAM,IAAIN,OAAO,CAACC,OAAO,IAAIjB,aAAa,CAACkB,GAAG,CAACK,UAAU,CAACC,UAAU,CAAC,MAAMP,OAAO,CAAC,IAAI,CAAC,EAAEK,OAAO,CAAC,CAAC,CAAC;MACpGR,QAAQ,EAAE;IACd;GACH,CAAC,CAACW,OAAO;AACd;AAEA;;;;;;AAMA,OAAM,SAAUC,uBAAuBA,CAAA;EACnC,MAAMC,KAAK,GAAGlB,wBAAwB,CAACmB,SAAS,CAAC;EAEjD,OAAOhC,KAAK,CAACgB,MAAM,CAAC;IAChBiB,oBAAoB,EAAEF,KAAK,CAACd,qBAAqB;IACjDQ,KAAK,EAAEM,KAAK,CAACN;GAChB,CAAC,CAACI,OAAO;AACd","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}